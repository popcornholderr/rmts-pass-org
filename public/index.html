<!DOCTYPE html>
<html>
<head>
  <title>Secure Access</title>
  <style>
    body, html { margin:0; height:100%; background:#000; color:#fff; }
    #msg { display:flex; align-items:center; justify-content:center; height:100vh; }
    iframe { width:100%; height:100vh; border:none; display:none; }
  </style>
</head>
<body>

<div id="msg">Checking accessâ€¦</div>
<iframe id="frame"></iframe>

<script>
  const TOKEN = "USER_TOKEN_001";
  const BACKEND = "https://rmts-pass-org.vercel.app";
  const HIDDEN_SITE = "https://fake-pass-lemon.vercel.app";

  function fingerprint() {
    return btoa(
      navigator.userAgent +
      screen.width +
      screen.height +
      Intl.DateTimeFormat().resolvedOptions().timeZone
    );
  }

  const device = fingerprint();

  // ðŸ”¥ Save device request locally to stop spam
  const requestedKey = "requested_" + TOKEN + "_" + device;

  async function checkAccess() {

    const res = await fetch(BACKEND + "/check", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ token: TOKEN, device })
    });

    const data = await res.json();

    if (data.status === "approved") {
      document.getElementById("msg").style.display = "none";
      const f = document.getElementById("frame");
      f.src = HIDDEN_SITE;
      f.style.display = "block";
      return;
    }

    requestApproval();
  }

  async function requestApproval() {

    // ðŸš« Prevent repeated requests from same device
    if (localStorage.getItem(requestedKey)) {
      document.getElementById("msg").innerText =
        "Access pending approval.";
      return;
    }

    await fetch(BACKEND + "/request", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ token: TOKEN, device })
    });

    localStorage.setItem(requestedKey, "true");

    document.getElementById("msg").innerText =
      "Access pending approval.";
  }

  checkAccess();
</script>

</body>
</html>
